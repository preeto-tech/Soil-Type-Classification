<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test AI Verification</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .result { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .error { background: #ffe6e6; color: #d00; }
        .success { background: #e6ffe6; color: #060; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        pre { white-space: pre-wrap; word-wrap: break-word; font-size: 12px; }
        .ai-section { background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007cba; }
        .agreement { padding: 5px 10px; border-radius: 3px; color: white; font-weight: bold; }
        .agree { background: #28a745; }
        .partial { background: #ffc107; color: #000; }
        .disagree { background: #dc3545; }
    </style>
</head>
<body>
    <h1>ü§ñ Test AI Verification System</h1>
    <p>Test the enhanced fertility prediction with AI verification</p>
    
    <button onclick="testWithHighFertility()">Test High Fertility Sample</button>
    <button onclick="testWithLowFertility()">Test Low Fertility Sample</button>
    <button onclick="testWithMediumFertility()">Test Medium Fertility Sample</button>
    
    <div id="result"></div>

    <script>
        async function testFertilityWithData(sampleData, testName) {
            document.getElementById('result').innerHTML = `<p>Testing ${testName}...</p>`;
            
            try {
                const response = await fetch('http://localhost:5000/predict-fertility', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(sampleData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    let resultHtml = `
                        <div class="result success">
                            <h3>‚úÖ ${testName} Results</h3>
                            <p><strong>ML Prediction:</strong> ${data.ml_prediction || data.prediction}</p>
                    `;
                    
                    if (data.ai_verification && !data.ai_verification.error) {
                        const av = data.ai_verification;
                        const agreementClass = av.agreement_with_ml === 'Agree' ? 'agree' : 
                                             av.agreement_with_ml === 'Partially Agree' ? 'partial' : 'disagree';
                        
                        resultHtml += `
                            <div class="ai-section">
                                <h4>ü§ñ AI Expert Verification</h4>
                                <p><strong>AI Prediction:</strong> ${av.ai_prediction || 'N/A'}</p>
                                <p><strong>Agreement:</strong> <span class="agreement ${agreementClass}">${av.agreement_with_ml || 'N/A'}</span></p>
                                <p><strong>Confidence:</strong> ${av.confidence || 'N/A'}</p>
                                
                                ${av.key_observations ? `
                                    <h5>Key Observations:</h5>
                                    <ul>${av.key_observations.map(obs => `<li>${obs}</li>`).join('')}</ul>
                                ` : ''}
                                
                                ${av.recommendations ? `
                                    <h5>Recommendations:</h5>
                                    <ul>${av.recommendations.map(rec => `<li>${rec}</li>`).join('')}</ul>
                                ` : ''}
                                
                                ${av.suitable_crops ? `
                                    <h5>Suitable Crops:</h5>
                                    <p>${av.suitable_crops.join(', ')}</p>
                                ` : ''}
                                
                                ${av.explanation ? `
                                    <h5>Expert Explanation:</h5>
                                    <p>${av.explanation}</p>
                                ` : ''}
                            </div>
                        `;
                    } else if (data.ai_verification?.error) {
                        resultHtml += `<p class="error">AI Verification Error: ${data.ai_verification.error}</p>`;
                    }
                    
                    resultHtml += `
                            <h4>Input Data:</h4>
                            <pre>${JSON.stringify(sampleData, null, 2)}</pre>
                            <h4>Full Response:</h4>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                    
                    document.getElementById('result').innerHTML = resultHtml;
                } else {
                    document.getElementById('result').innerHTML = 
                        `<div class="result error">
                            <h3>‚ùå Error (${response.status}):</h3>
                            <p>${data.message || data.error}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = 
                    `<div class="result error">
                        <h3>‚ùå Network Error:</h3>
                        <p>${error.message}</p>
                    </div>`;
            }
        }

        function testWithHighFertility() {
            const highFertilityData = {
                "N": 245,
                "P": 25.5,
                "K": 560,
                "ph": 7.31,
                "ec": 0.63,
                "oc": 1.8,
                "S": 25.6,
                "zn": 1.2,
                "fe": 4.5,
                "cu": 0.8,
                "Mn": 12.3,
                "B": 1.1
            };
            testFertilityWithData(highFertilityData, "High Fertility Sample");
        }

        function testWithLowFertility() {
            const lowFertilityData = {
                "N": 45,
                "P": 3.2,
                "K": 120,
                "ph": 5.8,
                "ec": 0.2,
                "oc": 0.3,
                "S": 5.1,
                "zn": 0.1,
                "fe": 0.2,
                "cu": 0.1,
                "Mn": 2.1,
                "B": 0.2
            };
            testFertilityWithData(lowFertilityData, "Low Fertility Sample");
        }

        function testWithMediumFertility() {
            const mediumFertilityData = {
                "N": 145,
                "P": 12.1,
                "K": 280,
                "ph": 6.8,
                "ec": 0.45,
                "oc": 0.9,
                "S": 15.2,
                "zn": 0.5,
                "fe": 1.8,
                "cu": 0.4,
                "Mn": 6.7,
                "B": 0.6
            };
            testFertilityWithData(mediumFertilityData, "Medium Fertility Sample");
        }
    </script>
</body>
</html>